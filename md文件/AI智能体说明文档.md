# AIæ™ºèƒ½ä½“å·¥ä½œåŸç†è¯´æ˜æ–‡æ¡£

## ä¸€ã€æ¦‚è¿°

æœ¬æ–‡æ¡£ä»¥ç”¨æˆ·æé—®"50å…ƒå›¾ä¹¦æœ‰å“ªäº›"ä¸ºä¾‹ï¼Œè¯¦ç»†è¯´æ˜AIæ™ºèƒ½ä½“ä»æ¥æ”¶é—®é¢˜åˆ°è¿”å›ç­”æ¡ˆçš„å®Œæ•´å·¥ä½œæµç¨‹ã€‚

## äºŒã€æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·ç•Œé¢å±‚                                  â”‚
â”‚                    (AiAssistant.vue å‰ç«¯ç»„ä»¶)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼ HTTP POST /ai/chat
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ¥å£å±‚                                      â”‚
â”‚                    (AiController.java)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æœåŠ¡å±‚                                      â”‚
â”‚                    (AiServiceImpl.java)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ æ„å›¾è¯†åˆ«    â”‚  â”‚ æ•°æ®åº“æŸ¥è¯¢  â”‚  â”‚ AIæ¨¡å‹è°ƒç”¨  â”‚                  â”‚
â”‚  â”‚ (æ­£åˆ™åŒ¹é…)  â”‚  â”‚ (MyBatis)   â”‚  â”‚ (æ™ºè°±GLM-4) â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           æ•°æ®å±‚                                      â”‚
â”‚              (MySQLæ•°æ®åº“ - bookã€categoryã€userè¡¨ç­‰)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ä¸‰ã€è¯¦ç»†æµç¨‹åˆ†æ

### åœºæ™¯ï¼šç”¨æˆ·æé—®"50å…ƒå›¾ä¹¦æœ‰å“ªäº›"

---

### ç¬¬ä¸€æ­¥ï¼šå‰ç«¯å‘é€è¯·æ±‚

**æ–‡ä»¶ä½ç½®ï¼š** `frontend/src/components/AiAssistant.vue`

å½“ç”¨æˆ·åœ¨èŠå¤©çª—å£è¾“å…¥"50å…ƒå›¾ä¹¦æœ‰å“ªäº›"å¹¶å‘é€æ—¶ï¼š

```typescript
async function sendMessage() {
  const userMessage = inputText.value.trim()  // "50å…ƒå›¾ä¹¦æœ‰å“ªäº›"
  
  // 1. æ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ç•Œé¢
  messages.value.push({ role: 'user', content: userMessage })
  
  // 2. æ˜¾ç¤ºæ‰“å­—åŠ¨ç”»
  isTyping.value = true
  
  // 3. è°ƒç”¨åç«¯AI API
  const res = await aiApi.chat({
    message: userMessage,           // "50å…ƒå›¾ä¹¦æœ‰å“ªäº›"
    sessionId: sessionId.value,     // ä¼šè¯IDï¼ˆç”¨äºè®°å¿†åŠŸèƒ½ï¼‰
    history: messages.value.slice(-10),  // æœ€è¿‘10æ¡å¯¹è¯å†å²
    currentPage: route.path         // å½“å‰é¡µé¢è·¯å¾„
  })
  
  // 4. æ˜¾ç¤ºAIå›å¤
  messages.value.push({ role: 'assistant', content: res.data.reply })
}
```

**è¯·æ±‚æ•°æ®ç»“æ„ï¼š**
```json
{
  "message": "50å…ƒå›¾ä¹¦æœ‰å“ªäº›",
  "sessionId": "abc123def456",
  "history": [...],
  "currentPage": "/home"
}
```

---

### ç¬¬äºŒæ­¥ï¼šåç«¯æ¥æ”¶å¹¶å¤„ç†è¯·æ±‚

**æ–‡ä»¶ä½ç½®ï¼š** `backgrond/src/main/java/com/example/booktrading/service/impl/AiServiceImpl.java`

#### 2.1 å…¥å£æ–¹æ³• `chat()`

```java
public AiChatVO chat(AiChatDTO dto) {
    // 1. å¤„ç†ä¼šè¯IDï¼ˆç”¨äºè®°å¿†åŠŸèƒ½ï¼‰
    String sessionId = dto.getSessionId();
    if (sessionId == null || sessionId.isEmpty()) {
        sessionId = UUID.randomUUID().toString().replace("-", "").substring(0, 16);
    }
    
    // 2. è·å–/åˆ›å»ºä¼šè¯è®°å¿†
    List<AiChatDTO.ChatMessage> memory = sessionMemory.computeIfAbsent(sessionId, k -> new ArrayList<>());
    
    // 3. ã€å…³é”®ã€‘æ ¹æ®ç”¨æˆ·é—®é¢˜æŸ¥è¯¢ç›¸å…³æ•°æ®
    String contextData = queryRelevantData(dto.getMessage());  // "50å…ƒå›¾ä¹¦æœ‰å“ªäº›"
    
    // 4. æ„å»ºç³»ç»Ÿæç¤ºè¯
    String systemPrompt = buildSystemPrompt(dto.getCurrentPage(), contextData);
    
    // 5. è°ƒç”¨AI APIè·å–å›å¤
    String reply = callZhipuApi(systemPrompt, dto.getMessage(), memory);
    
    // 6. ä¿å­˜å¯¹è¯åˆ°è®°å¿†
    // ...
    
    return AiChatVO.success(reply, sessionId);
}
```

---

### ç¬¬ä¸‰æ­¥ï¼šæ„å›¾è¯†åˆ«ä¸æ•°æ®æŸ¥è¯¢ï¼ˆæ ¸å¿ƒï¼‰

**è¿™æ˜¯å›ç­”"50å…ƒå›¾ä¹¦æœ‰å“ªäº›"çš„å…³é”®æ­¥éª¤ï¼**

#### 3.1 `queryRelevantData()` æ–¹æ³•

```java
private String queryRelevantData(String message) {
    StringBuilder data = new StringBuilder();
    String msg = message.toLowerCase();  // "50å…ƒå›¾ä¹¦æœ‰å“ªäº›"
    
    // ã€ä¼˜å…ˆã€‘æ£€æŸ¥ä»·æ ¼èŒƒå›´æŸ¥è¯¢
    String priceResult = queryBooksByPriceRange(message);
    if (!priceResult.isEmpty()) {
        data.append(priceResult);
        return data.toString();  // ä»·æ ¼æŸ¥è¯¢ä¼˜å…ˆè¿”å›
    }
    
    // å…¶ä»–æŸ¥è¯¢é€»è¾‘...
}
```

#### 3.2 `queryBooksByPriceRange()` æ–¹æ³• - ä»·æ ¼è§£æä¸æ•°æ®åº“æŸ¥è¯¢

```java
private String queryBooksByPriceRange(String message) {
    StringBuilder sb = new StringBuilder();
    Integer maxPrice = null;
    Integer minPrice = null;
    
    // ã€æ­£åˆ™åŒ¹é…ã€‘è§£æä»·æ ¼è¡¨è¾¾å¼
    // åŒ¹é… "50å…ƒä»¥ä¸‹"ã€"50ä»¥ä¸‹"ã€"50å—ä»¥ä¸‹" ç­‰
    Pattern maxPattern = Pattern.compile("(\\d+)\\s*(?:å…ƒ|å—|å—é’±)?\\s*(?:ä»¥ä¸‹|ä»¥å†…|å†…|ä¹‹å†…)");
    Matcher maxMatcher = maxPattern.matcher(message);
    if (maxMatcher.find()) {
        maxPrice = Integer.parseInt(maxMatcher.group(1));  // æå–åˆ° 50
    }
    
    // å¯¹äº"50å…ƒå›¾ä¹¦æœ‰å“ªäº›"ï¼Œä¼šåŒ¹é…åˆ°ç²¾ç¡®ä»·æ ¼
    // è¿™é‡Œä¼šå°è¯•å¤šç§æ¨¡å¼åŒ¹é…...
```

**ä»·æ ¼åŒ¹é…æ¨¡å¼è¯´æ˜ï¼š**

| ç”¨æˆ·è¾“å…¥ | æ­£åˆ™æ¨¡å¼ | æå–ç»“æœ |
|---------|---------|---------|
| "50å…ƒä»¥ä¸‹çš„ä¹¦" | `(\d+)\s*(?:å…ƒ)?(?:ä»¥ä¸‹)` | maxPrice = 50 |
| "ä¸è¶…è¿‡50" | `(?:ä¸è¶…è¿‡)\s*(\d+)` | maxPrice = 50 |
| "50å…ƒä»¥ä¸Š" | `(\d+)\s*(?:å…ƒ)?(?:ä»¥ä¸Š)` | minPrice = 50 |
| "20åˆ°50å…ƒ" | `(\d+)\s*(?:åˆ°)\s*(\d+)` | minPrice=20, maxPrice=50 |

#### 3.3 æ•°æ®åº“æŸ¥è¯¢

```java
// æ„å»ºMyBatis-PlusæŸ¥è¯¢æ¡ä»¶
LambdaQueryWrapper<Book> wrapper = new LambdaQueryWrapper<Book>()
    .eq(Book::getStatus, 1);  // åªæŸ¥è¯¢åœ¨å”®ä¹¦ç±

// æ ¹æ®è§£æå‡ºçš„ä»·æ ¼æ¡ä»¶æ·»åŠ æŸ¥è¯¢
if (maxPrice != null) {
    wrapper.le(Book::getPrice, maxPrice);  // price <= 50
}

// æŒ‰ä»·æ ¼å‡åºï¼Œé™åˆ¶10æ¡
wrapper.orderByAsc(Book::getPrice).last("LIMIT 10");

// æ‰§è¡ŒæŸ¥è¯¢
List<Book> books = bookMapper.selectList(wrapper);
```

**ç”Ÿæˆçš„SQLè¯­å¥ï¼š**
```sql
SELECT * FROM book 
WHERE status = 1 
  AND price <= 50 
ORDER BY price ASC 
LIMIT 10
```

#### 3.4 æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ

```java
if (!books.isEmpty()) {
    sb.append("\nã€50å…ƒä»¥ä¸‹çš„ä¹¦ç±ï¼Œå…±").append(books.size()).append("æœ¬ã€‘\n");
    for (int i = 0; i < books.size(); i++) {
        Book b = books.get(i);
        sb.append(String.format("%d. ã€Š%sã€‹- %s\n   ğŸ’° %.2få…ƒ | %s\n",
            i + 1, 
            b.getTitle(),      // ä¹¦å
            b.getAuthor(),     // ä½œè€…
            b.getPrice(),      // ä»·æ ¼
            getConditionDesc(b.getConditionLevel())  // æˆè‰²
        ));
    }
}
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
ã€50å…ƒä»¥ä¸‹çš„ä¹¦ç±ï¼Œå…±5æœ¬ã€‘
1. ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹- Bruce Eckel
   ğŸ’° 35.00å…ƒ | ä¹æˆæ–°
2. ã€Šç®—æ³•å¯¼è®ºã€‹- Thomas H. Cormen
   ğŸ’° 42.50å…ƒ | å…«æˆæ–°
3. ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹- Randal E. Bryant
   ğŸ’° 48.00å…ƒ | å…¨æ–°
...
```

---

### ç¬¬å››æ­¥ï¼šæ„å»ºAIæç¤ºè¯

```java
private String buildSystemPrompt(String currentPage, String contextData) {
    StringBuilder prompt = new StringBuilder();
    
    // 1. è§’è‰²è®¾å®š
    prompt.append("ä½ æ˜¯\"äºŒæ‰‹ä¹¦äº¤æ˜“å¹³å°\"çš„æ™ºèƒ½å®¢æœåŠ©æ‰‹ï¼Œåå«\"å°ä¹¦\"ã€‚\n");
    prompt.append("ä½ çš„èŒè´£æ˜¯å¸®åŠ©ç”¨æˆ·äº†è§£å¹³å°åŠŸèƒ½ã€è§£ç­”ä½¿ç”¨é—®é¢˜ã€æ¨èä¹¦ç±ã€æä¾›æ•°æ®æŸ¥è¯¢ã€‚\n");
    
    // 2. æ·»åŠ çŸ¥è¯†åº“
    prompt.append(knowledgeBase);  // å¹³å°ä½¿ç”¨æŒ‡å—ã€å¸¸è§é—®é¢˜ç­‰
    
    // 3. ã€å…³é”®ã€‘æ·»åŠ å®æ—¶æŸ¥è¯¢çš„æ•°æ®åº“æ•°æ®
    if (contextData != null && !contextData.isEmpty()) {
        prompt.append("\nä»¥ä¸‹æ˜¯æ ¹æ®ç”¨æˆ·é—®é¢˜ä»æ•°æ®åº“å®æ—¶æŸ¥è¯¢çš„æ•°æ®ï¼Œè¯·åŸºäºè¿™äº›çœŸå®æ•°æ®å›ç­”ï¼š\n");
        prompt.append(contextData);  // åŒ…å«æŸ¥è¯¢åˆ°çš„ä¹¦ç±åˆ—è¡¨
    }
    
    // 4. æ·»åŠ çº¦æŸ
    prompt.append("\né‡è¦æç¤ºï¼š\n");
    prompt.append("1. å›ç­”è¦åŸºäºä¸Šé¢æä¾›çš„çœŸå®æ•°æ®ï¼Œä¸è¦ç¼–é€ æ•°æ®\n");
    prompt.append("2. å¦‚æœæ•°æ®ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯šå®å‘ŠçŸ¥ç”¨æˆ·\n");
    
    return prompt.toString();
}
```

---

### ç¬¬äº”æ­¥ï¼šè°ƒç”¨æ™ºè°±AI API

```java
private String callZhipuApi(String systemPrompt, String userMessage, 
                            List<AiChatDTO.ChatMessage> history) throws IOException {
    
    // æ„å»ºæ¶ˆæ¯åˆ—è¡¨
    JsonArray messages = new JsonArray();
    
    // 1. ç³»ç»Ÿæ¶ˆæ¯ï¼ˆåŒ…å«çŸ¥è¯†åº“+æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼‰
    JsonObject systemMsg = new JsonObject();
    systemMsg.addProperty("role", "system");
    systemMsg.addProperty("content", systemPrompt);
    messages.add(systemMsg);
    
    // 2. å†å²å¯¹è¯ï¼ˆè®°å¿†åŠŸèƒ½ï¼‰
    for (AiChatDTO.ChatMessage msg : history) {
        // æ·»åŠ å†å²æ¶ˆæ¯...
    }
    
    // 3. å½“å‰ç”¨æˆ·æ¶ˆæ¯
    JsonObject userMsg = new JsonObject();
    userMsg.addProperty("role", "user");
    userMsg.addProperty("content", userMessage);  // "50å…ƒå›¾ä¹¦æœ‰å“ªäº›"
    messages.add(userMsg);
    
    // 4. å‘é€HTTPè¯·æ±‚åˆ°æ™ºè°±API
    Request request = new Request.Builder()
        .url("https://open.bigmodel.cn/api/paas/v4/chat/completions")
        .addHeader("Authorization", "Bearer " + apiKey)
        .post(RequestBody.create(gson.toJson(requestBody), MediaType.parse("application/json")))
        .build();
    
    // 5. è§£æå“åº”
    Response response = httpClient.newCall(request).execute();
    // ...è¿”å›AIç”Ÿæˆçš„å›å¤
}
```

---

### ç¬¬å…­æ­¥ï¼šè¿”å›ç»“æœç»™å‰ç«¯

```java
return AiChatVO.success(reply, sessionId);
```

**å“åº”æ•°æ®ç»“æ„ï¼š**
```json
{
  "success": true,
  "reply": "ğŸ“š ä¸ºæ‚¨æ‰¾åˆ°ä»¥ä¸‹50å…ƒä»¥ä¸‹çš„ä¹¦ç±ï¼š\n\n1. ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹- Bruce Eckel\n   ğŸ’° 35.00å…ƒ | ä¹æˆæ–°\n...",
  "sessionId": "abc123def456"
}
```

---

## å››ã€æµç¨‹å›¾æ€»ç»“

```
ç”¨æˆ·è¾“å…¥: "50å…ƒå›¾ä¹¦æœ‰å“ªäº›"
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ AiAssistant.vue               â”‚
â”‚  - æ”¶é›†ç”¨æˆ·è¾“å…¥                      â”‚
â”‚  - å‘é€POSTè¯·æ±‚åˆ° /ai/chat          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯ AiServiceImpl.chat()          â”‚
â”‚  - å¤„ç†ä¼šè¯ID                        â”‚
â”‚  - åŠ è½½ä¼šè¯è®°å¿†                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  queryRelevantData()                â”‚
â”‚  - åˆ†æç”¨æˆ·æ„å›¾                      â”‚
â”‚  - è¯†åˆ«ä¸º"ä»·æ ¼æŸ¥è¯¢"                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  queryBooksByPriceRange()           â”‚
â”‚  - æ­£åˆ™åŒ¹é…æå–ä»·æ ¼: 50              â”‚
â”‚  - æ„å»ºSQL: price <= 50             â”‚
â”‚  - æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢                    â”‚
â”‚  - æ ¼å¼åŒ–æŸ¥è¯¢ç»“æœ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  buildSystemPrompt()                â”‚
â”‚  - ç»„è£…è§’è‰²è®¾å®š                      â”‚
â”‚  - æ·»åŠ çŸ¥è¯†åº“å†…å®¹                    â”‚
â”‚  - ã€æ³¨å…¥æ•°æ®åº“æŸ¥è¯¢ç»“æœã€‘            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  callZhipuApi()                     â”‚
â”‚  - æ„å»ºæ¶ˆæ¯åˆ—è¡¨                      â”‚
â”‚  - è°ƒç”¨æ™ºè°±GLM-4æ¨¡å‹                 â”‚
â”‚  - è·å–è‡ªç„¶è¯­è¨€å›å¤                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›ç»™å‰ç«¯                          â”‚
â”‚  - æ˜¾ç¤ºAIå›å¤                        â”‚
â”‚  - ä¿å­˜åˆ°æœ¬åœ°ä¼šè¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## äº”ã€å…³é”®æŠ€æœ¯ç‚¹

### 5.1 æ„å›¾è¯†åˆ«ï¼ˆåŸºäºæ­£åˆ™è¡¨è¾¾å¼ï¼‰

ç³»ç»Ÿä½¿ç”¨å¤šç§æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼è¯†åˆ«ç”¨æˆ·æ„å›¾ï¼š

| æ„å›¾ç±»å‹ | å…³é”®è¯/æ¨¡å¼ | è§¦å‘çš„æŸ¥è¯¢ |
|---------|------------|-----------|
| ä»·æ ¼èŒƒå›´ | `\d+å…ƒä»¥ä¸‹`ã€`ä¸è¶…è¿‡\d+` | æŒ‰ä»·æ ¼ç­›é€‰ä¹¦ç± |
| ç»Ÿè®¡æ•°æ® | "å¤šå°‘"ã€"æ•°é‡"ã€"ç»Ÿè®¡" | æŸ¥è¯¢å¹³å°ç»Ÿè®¡ |
| åˆ†ç±»æŸ¥è¯¢ | "åˆ†ç±»"ã€"ç±»åˆ«" | æŸ¥è¯¢ä¹¦ç±åˆ†ç±» |
| æ¨èä¹¦ç± | "æ¨è"ã€"çƒ­é—¨" | æŒ‰æµè§ˆé‡æ’åº |
| ç‰¹å®šä¹¦ç± | `ã€Šä¹¦åã€‹` | æ¨¡ç³Šæœç´¢ä¹¦å |

### 5.2 RAGæ¨¡å¼ï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰

æœ¬ç³»ç»Ÿé‡‡ç”¨äº†ç®€åŒ–ç‰ˆçš„RAGæ¨¡å¼ï¼š

1. **æ£€ç´¢ï¼ˆRetrievalï¼‰**ï¼šæ ¹æ®ç”¨æˆ·é—®é¢˜ï¼Œä»æ•°æ®åº“æ£€ç´¢ç›¸å…³æ•°æ®
2. **å¢å¼ºï¼ˆAugmentationï¼‰**ï¼šå°†æ£€ç´¢ç»“æœæ³¨å…¥åˆ°AIæç¤ºè¯ä¸­
3. **ç”Ÿæˆï¼ˆGenerationï¼‰**ï¼šAIåŸºäºçœŸå®æ•°æ®ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤

### 5.3 ä¼šè¯è®°å¿†

- ä½¿ç”¨`ConcurrentHashMap`å­˜å‚¨ä¼šè¯å†å²
- æ¯ä¸ªä¼šè¯ä¿ç•™æœ€è¿‘10è½®å¯¹è¯
- æ”¯æŒä¸Šä¸‹æ–‡è¿ç»­å¯¹è¯

### 5.4 é™çº§ç­–ç•¥

å½“AI APIä¸å¯ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šä½¿ç”¨æœ¬åœ°è§„åˆ™å¼•æ“ç”Ÿæˆå›å¤ï¼š

```java
private String generateLocalResponse(String message) {
    // åŸºäºå…³é”®è¯åŒ¹é…çš„æœ¬åœ°å›å¤é€»è¾‘
    // ä»ç„¶ä¼šæŸ¥è¯¢æ•°æ®åº“è·å–çœŸå®æ•°æ®
}
```

## å…­ã€æ€»ç»“

å½“ç”¨æˆ·é—®"50å…ƒå›¾ä¹¦æœ‰å“ªäº›"æ—¶ï¼Œç³»ç»Ÿçš„å¤„ç†æµç¨‹æ˜¯ï¼š

1. **å‰ç«¯**æ”¶é›†ç”¨æˆ·è¾“å…¥ï¼Œå‘é€HTTPè¯·æ±‚
2. **åç«¯**é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ª"ä»·æ ¼æŸ¥è¯¢"æ„å›¾
3. **æå–ä»·æ ¼**ï¼šä»æ–‡æœ¬ä¸­æå–å‡ºæ•°å­—"50"
4. **æ•°æ®åº“æŸ¥è¯¢**ï¼šæ‰§è¡Œ `SELECT * FROM book WHERE price <= 50`
5. **æ„å»ºæç¤ºè¯**ï¼šå°†æŸ¥è¯¢ç»“æœæ³¨å…¥åˆ°AIçš„ç³»ç»Ÿæç¤ºè¯ä¸­
6. **è°ƒç”¨AI**ï¼šæ™ºè°±GLM-4åŸºäºçœŸå®æ•°æ®ç”Ÿæˆè‡ªç„¶è¯­è¨€å›å¤
7. **è¿”å›ç»“æœ**ï¼šå‰ç«¯å±•ç¤ºæ ¼å¼åŒ–çš„ä¹¦ç±åˆ—è¡¨

è¿™ç§è®¾è®¡ç¡®ä¿äº†AIå›å¤çš„**å‡†ç¡®æ€§**ï¼ˆåŸºäºçœŸå®æ•°æ®åº“æ•°æ®ï¼‰å’Œ**è‡ªç„¶æ€§**ï¼ˆç”±å¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆæµç•…çš„å›å¤ï¼‰ã€‚
