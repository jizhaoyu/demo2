# 需求文档

## 简介

二手书交易管理系统是一个前后端分离的Web应用，旨在为用户提供二手书籍的发布、浏览、购买和管理功能。系统支持用户注册登录、书籍信息管理、交易流程管理等核心功能，采用Java SpringBoot后端 + Vue3前端的技术架构。

## 术语表

- **系统**: 二手书交易管理系统
- **用户**: 系统的注册用户，可以发布和购买二手书
- **管理员**: 系统管理员，拥有用户管理和内容审核权限
- **书籍**: 二手书籍实体，包含书名、作者、价格、状态等信息
- **订单**: 交易订单，记录买卖双方的交易信息
- **分类**: 书籍分类，用于组织和筛选书籍
- **评价**: 交易完成后买卖双方的互评记录
- **消息**: 用户之间的站内通信记录
- **JWT令牌**: 用户身份认证令牌

## 需求列表

### 需求1：用户认证与授权

**用户故事：** 作为用户，我希望能够注册和登录系统，以便访问个性化功能并管理我的书籍。

#### 验收标准

1. 当访客提交有效的注册信息（用户名、密码、邮箱、手机号）时，系统应创建新用户账户并返回成功响应
2. 当访客提交的注册信息中用户名或邮箱已存在时，系统应拒绝注册并返回具体错误信息
3. 当用户提交有效的登录凭证时，系统应验证用户身份并返回JWT令牌
4. 当用户提交无效的登录凭证时，系统应拒绝登录并返回认证错误
5. 当用户携带有效JWT令牌请求受保护资源时，系统应允许访问该资源
6. 当用户未携带有效JWT令牌请求受保护资源时，系统应返回401未授权错误
7. 当用户请求登出时，系统应使当前会话失效

### 需求2：用户信息管理

**用户故事：** 作为用户，我希望能够查看和更新我的个人信息，以便保持账户信息的准确性。

#### 验收标准

1. 当已登录用户请求个人资料时，系统应返回用户的个人信息
2. 当已登录用户使用有效数据更新个人资料时，系统应保存更改并返回成功响应
3. 当已登录用户使用正确的旧密码修改密码时，系统应更新密码
4. 如果用户修改密码时提供的旧密码不正确，系统应拒绝修改并返回错误

### 需求3：书籍信息管理

**用户故事：** 作为用户，我希望能够发布、编辑和管理我的二手书，以便将它们出售给其他用户。

#### 验收标准

1. 当已登录用户提交包含必填字段（书名、作者、价格、成色、分类、描述）的新书籍时，系统应创建书籍并将状态设为"在售"
2. 当用户提交缺少必填字段的书籍时，系统应拒绝提交并返回验证错误
3. 当书籍所有者请求编辑其书籍时，系统应允许修改书籍详情
4. 当非所有者用户尝试编辑书籍时，系统应拒绝请求并返回403禁止访问错误
5. 当书籍所有者请求删除其书籍时，系统应将书籍标记为已删除（软删除）
6. 当书籍所有者更改书籍状态（在售、已售、下架）时，系统应相应更新书籍状态
7. 当用户上传书籍图片时，系统应存储图片并将其与书籍关联

### 需求4：书籍浏览与搜索

**用户故事：** 作为用户，我希望能够浏览和搜索二手书，以便找到我想购买的书籍。

#### 验收标准

1. 当用户请求书籍列表时，系统应返回分页的书籍列表及基本信息
2. 当用户按关键词搜索书籍时，系统应返回书名或作者包含该关键词的书籍
3. 当用户按分类筛选书籍时，系统应仅返回指定分类的书籍
4. 当用户按价格区间筛选书籍时，系统应返回指定价格范围内的书籍
5. 当用户请求书籍详情时，系统应返回完整的书籍信息（包括卖家信息）
6. 当用户按价格或发布日期排序书籍时，系统应按指定顺序返回书籍

### 需求5：书籍分类管理

**用户故事：** 作为管理员，我希望能够管理书籍分类，以便书籍能够被正确组织。

#### 验收标准

1. 系统应提供预定义的书籍分类（文学、教材、科技、艺术、生活、其他）
2. 当管理员创建新分类时，系统应将该分类添加到系统中
3. 当管理员更新分类时，系统应修改分类信息
4. 当管理员删除没有关联书籍的分类时，系统应移除该分类
5. 如果管理员尝试删除有关联书籍的分类，系统应拒绝删除

### 需求6：书籍收藏

**用户故事：** 作为用户，我希望能够收藏感兴趣的书籍，以便稍后方便查找和购买。

#### 验收标准

1. 当已登录用户将书籍添加到收藏时，系统应创建收藏记录并返回成功
2. 当用户尝试添加已收藏的书籍时，系统应返回错误提示书籍已在收藏中
3. 当用户从收藏中移除书籍时，系统应删除收藏记录
4. 当用户请求收藏列表时，系统应返回分页的已收藏书籍列表及书籍详情
5. 当用户检查书籍是否已收藏时，系统应返回收藏状态（是/否）
6. 当已收藏的书籍被删除或售出时，系统应保留收藏记录但相应标记书籍状态

### 需求7：订单管理

**用户故事：** 作为用户，我希望能够创建和管理订单，以便完成书籍交易。

#### 验收标准

1. 当买家为可购买的书籍创建订单时，系统应创建状态为"待确认"的订单并将书籍状态更新为"已预订"
2. 当买家尝试购买自己的书籍时，系统应拒绝订单
3. 当买家尝试购买非"在售"状态的书籍时，系统应拒绝订单
4. 当卖家确认订单时，系统应将订单状态更新为"已确认"
5. 当买家完成支付时，系统应将订单状态更新为"已支付"
6. 当卖家发货时，系统应将订单状态更新为"已发货"
7. 当买家确认收货时，系统应将订单状态更新为"已完成"并将书籍状态更新为"已售"
8. 当买家或卖家在发货前取消订单时，系统应将订单状态更新为"已取消"并将书籍状态恢复为"在售"
9. 当用户请求订单列表时，系统应返回用户作为买家或卖家的订单

### 需求8：交易评价

**用户故事：** 作为用户，我希望能够在交易完成后对交易进行评价，以便帮助其他用户了解卖家/买家的信誉。

#### 验收标准

1. 当订单状态为"已完成"时，系统应允许买家和卖家互相评价
2. 当用户提交评价时，系统应记录评分（1-5星）和评价内容
3. 当用户尝试对同一订单重复评价时，系统应拒绝并返回错误
4. 当用户尝试评价非"已完成"状态的订单时，系统应拒绝评价
5. 当用户查看某用户的评价列表时，系统应返回该用户收到的所有评价（分页）
6. 当用户查看书籍详情时，系统应显示卖家的平均评分和评价数量
7. 当评价被提交后，系统应更新被评价用户的平均评分

### 需求9：站内消息

**用户故事：** 作为用户，我希望能够与其他用户进行站内消息沟通，以便在交易前后进行必要的交流。

#### 验收标准

1. 当已登录用户向另一用户发送消息时，系统应创建消息记录并通知接收方
2. 当用户请求消息列表时，系统应返回用户的会话列表（按最新消息时间排序）
3. 当用户请求与某用户的聊天记录时，系统应返回双方的消息历史（分页）
4. 当用户收到新消息时，系统应更新未读消息计数
5. 当用户阅读消息时，系统应将消息标记为已读并更新未读计数
6. 当用户删除会话时，系统应将该会话标记为已删除（仅对当前用户不可见）
7. 当用户被禁用时，系统应阻止该用户发送消息

### 需求10：管理员功能

**用户故事：** 作为管理员，我希望能够管理用户和内容，以便维护系统质量并处理违规行为。

#### 验收标准

1. 当管理员请求用户列表时，系统应返回分页的用户信息
2. 当管理员禁用用户账户时，系统应阻止该用户登录
3. 当管理员启用已禁用的用户账户时，系统应恢复该用户的登录能力
4. 当管理员审核被举报的内容时，系统应允许管理员采取操作（通过、拒绝、删除）
5. 当管理员查看系统统计时，系统应返回用户数量、书籍数量、订单数量和交易统计

### 需求11：数据持久化

**用户故事：** 作为开发者，我希望数据能够被正确存储和检索，以便系统保持数据完整性。

#### 验收标准

1. 系统应使用BCrypt算法加密存储用户密码
2. 系统应使用正确的外键关系存储书籍数据（关联用户和分类）
3. 系统应使用正确的外键关系存储订单数据（关联书籍、买家和卖家）
4. 系统应使用正确的外键关系存储评价数据（关联订单、评价者和被评价者）
5. 系统应使用正确的外键关系存储消息数据（关联发送者和接收者）
6. 当存储时间戳时，系统应使用统一的日期时间格式（yyyy-MM-dd HH:mm:ss）
7. 系统应对用户、书籍、订单实现软删除以保持数据完整性
8. 当将数据序列化为JSON用于API响应时，系统应使用统一的字段命名（驼峰命名法）
